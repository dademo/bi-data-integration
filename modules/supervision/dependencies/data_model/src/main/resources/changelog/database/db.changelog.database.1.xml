<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ This Source Code Form is subject to the terms of the Mozilla Public
  ~ License, v. 2.0. If a copy of the MPL was not distributed with this
  ~ file, You can obtain one at https://mozilla.org/MPL/2.0/.
  -->
<databaseChangeLog
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.5.xsd">

    <changeSet id="1" author="dademo">
        <comment>Database-related tables</comment>

        <!-- fr.dademo.supervision.entities.database.connection.DataBackendDatabaseConnectionEntity -->
        <createTable tableName="data_backend_database_connection" schemaName="${schema_name}">
            <column name="id" type="INTEGER" autoIncrement="true">
                <constraints nullable="false" primaryKey="true" unique="true"/>
            </column>
            <column name="id_data_backend_description" type="INTEGER">
                <constraints
                    nullable="false" unique="false"
                    foreignKeyName="fk_data_backend_database_connection__data_backend_description_id"
                    referencedTableSchemaName="${schema_name}"
                    referencedTableName="data_backend_state_execution"
                    referencedColumnNames="id"
                />
            </column>
            <column name="id_backend_state_execution" type="INTEGER">
                <constraints
                    nullable="false" unique="false"
                    foreignKeyName="fk_data_backend_database_connection__data_backend_state_execution_id"
                    referencedTableSchemaName="${schema_name}"
                    referencedTableName="data_backend_state_execution"
                    referencedColumnNames="id"
                />
            </column>
            <column name="connection_state" type="VARCHAR(50)">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="connection_pid" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="connected_database_name" type="VARCHAR(255)">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="user_name" type="VARCHAR(255)">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="application_name" type="VARCHAR(255)">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="client_address" type="CLOB">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="client_host_name" type="VARCHAR(255)">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="client_port" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="connection_start" type="DATETIME">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="transaction_start" type="DATETIME">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="last_query_start" type="DATETIME">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="last_state_change" type="DATETIME">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="wait_event_type" type="CLOB">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="wait_event_name" type="CLOB">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="last_query" type="CLOB">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="backend_type_name" type="CLOB">
                <constraints nullable="true" unique="false"/>
            </column>
        </createTable>
        <createIndex tableName="data_backend_database_connection"
                     indexName="idx_data_backend_database_connection_user_name"
                     schemaName="${schema_name}">
            <column name="user_name" descending="true"/>
        </createIndex>
        <createIndex tableName="data_backend_database_connection"
                     indexName="idx_data_backend_database_connection_application_name"
                     schemaName="${schema_name}">
            <column name="application_name" descending="true"/>
        </createIndex>
        <createIndex tableName="data_backend_database_connection"
                     indexName="idx_data_backend_database_connection_client_address"
                     schemaName="${schema_name}">
            <column name="client_address" descending="true"/>
        </createIndex>
        <createIndex tableName="data_backend_database_connection"
                     indexName="idx_data_backend_database_connection_client_address_port"
                     schemaName="${schema_name}">
            <column name="client_address" descending="true"/>
            <column name="client_port" descending="true"/>
        </createIndex>
        <createIndex tableName="data_backend_database_connection"
                     indexName="idx_data_backend_database_connection_client_host_name"
                     schemaName="${schema_name}">
            <column name="client_host_name" descending="true"/>
        </createIndex>
        <createIndex tableName="data_backend_database_connection"
                     indexName="idx_data_backend_database_connection_client_host_name_port"
                     schemaName="${schema_name}">
            <column name="client_host_name" descending="true"/>
            <column name="client_port" descending="true"/>
        </createIndex>

        <!-- fr.dademo.supervision.entities.database.database.DataBackendDatabaseEntity -->
        <createTable tableName="data_backend_database" schemaName="${schema_name}">
            <column name="id" type="INTEGER" autoIncrement="true">
                <constraints nullable="false" primaryKey="true" unique="true"/>
            </column>
            <column name="id_data_backend_description" type="INTEGER">
                <constraints
                    nullable="false" unique="false"
                    foreignKeyName="fk_data_backend_database__data_backend_description_id"
                    referencedTableSchemaName="${schema_name}"
                    referencedTableName="data_backend_description"
                    referencedColumnNames="id"
                />
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="true" unique="false"/>
            </column>
        </createTable>
        <addUniqueConstraint
            constraintName="data_backend_database_uniq"
            tableName="data_backend_database"
            columnNames="id_data_backend_description, name"
            schemaName="${schema_name}"
        />
        <createIndex tableName="data_backend_database"
                     indexName="idx_data_backend_database_name"
                     schemaName="${schema_name}">
            <column name="name" descending="false"/>
        </createIndex>

        <!-- fr.dademo.supervision.entities.database.database.DataBackendDatabaseStatisticsEntity -->
        <createTable tableName="data_backend_database_statistics" schemaName="${schema_name}">
            <column name="id" type="INTEGER" autoIncrement="true">
                <constraints nullable="false" primaryKey="true" unique="true"/>
            </column>
            <column name="id_database" type="INTEGER">
                <constraints
                    nullable="false" unique="false"
                    foreignKeyName="fk_data_backend_database_statistics__data_backend_database_id"
                    referencedTableSchemaName="${schema_name}"
                    referencedTableName="data_backend_database"
                    referencedColumnNames="id"
                />
            </column>
            <column name="id_backend_state_execution" type="INTEGER">
                <constraints
                    nullable="false" unique="false"
                    foreignKeyName="fk_data_backend_database_statistics__data_backend_state_execution_id"
                    referencedTableSchemaName="${schema_name}"
                    referencedTableName="data_backend_state_execution"
                    referencedColumnNames="id"
                />
            </column>
            <column name="memory_usage_bytes" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="cpu_usage_millicpu" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="commits_count" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="rollbacks_count" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="buffer_blocks_read" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="disk_blocks_read" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="returned_rows_count" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="fetched_rows_count" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="inserted_rows_count" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="updated_rows_count" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="deleted_rows_count" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="conflicts_count" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="dead_locks_count" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="read_time_milliseconds" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="write_time_milliseconds" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
        </createTable>
        <addUniqueConstraint
            constraintName="data_backend_database_statistics_uniq"
            tableName="data_backend_database_statistics"
            columnNames="id_database, id_backend_state_execution"
            schemaName="${schema_name}"
        />

        <!-- fr.dademo.supervision.dependencies.entities.database.databasereplicationpeer.DataBackendDatabaseReplicationPeerEntity -->
        <createTable tableName="data_backend_database_replication_peer" schemaName="${schema_name}">
            <column name="id" type="INTEGER" autoIncrement="true">
                <constraints nullable="false" primaryKey="true" unique="true"/>
            </column>
            <column name="id_data_backend_description" type="INTEGER">
                <constraints
                    nullable="false" unique="false"
                    foreignKeyName="fk_data_backend_database_replication_peer__data_backend_description_id"
                    referencedTableSchemaName="${schema_name}"
                    referencedTableName="data_backend_description"
                    referencedColumnNames="id"
                />
            </column>
            <column name="target_database" type="VARCHAR(255)">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="use_name" type="VARCHAR(255)">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="application_name" type="VARCHAR(255)">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="slot_name" type="VARCHAR(255)">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="peer_address" type="VARCHAR(255)">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="peer_host_name" type="VARCHAR(255)">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="peer_port" type="INTEGER">
                <constraints nullable="true" unique="false"/>
            </column>
        </createTable>
        <addUniqueConstraint
            constraintName="data_backend_database_replication_peer_uniq"
            tableName="data_backend_database_replication_peer"
            columnNames="id_data_backend_description, target_database, application_name, slot_name, peer_address, peer_host_name, peer_port"
            schemaName="${schema_name}"
        />
        <createIndex tableName="data_backend_database_replication_peer"
                     indexName="idx_data_backend_database_replication_peer_target_database"
                     schemaName="${schema_name}">
            <column name="target_database" descending="true"/>
        </createIndex>
        <createIndex tableName="data_backend_database_replication_peer"
                     indexName="idx_data_backend_database_replication_peer_use_name"
                     schemaName="${schema_name}">
            <column name="use_name" descending="true"/>
        </createIndex>
        <createIndex tableName="data_backend_database_replication_peer"
                     indexName="idx_data_backend_database_replication_peer_application_name"
                     schemaName="${schema_name}">
            <column name="application_name" descending="true"/>
        </createIndex>
        <createIndex tableName="data_backend_database_replication_peer"
                     indexName="idx_data_backend_database_replication_peer_slot_name"
                     schemaName="${schema_name}">
            <column name="slot_name" descending="true"/>
        </createIndex>
        <createIndex tableName="data_backend_database_replication_peer"
                     indexName="idx_data_backend_database_replication_peer_peer_address"
                     schemaName="${schema_name}">
            <column name="peer_address" descending="true"/>
        </createIndex>
        <createIndex tableName="data_backend_database_replication_peer"
                     indexName="idx_data_backend_database_replication_peer_host_name"
                     schemaName="${schema_name}">
            <column name="peer_host_name" descending="true"/>
        </createIndex>
        <createIndex tableName="data_backend_database_replication_peer"
                     indexName="idx_data_backend_database_replication_peer_port"
                     schemaName="${schema_name}">
            <column name="peer_port" descending="true"/>
        </createIndex>


        <!-- fr.dademo.supervision.dependencies.entities.database.databasereplicationpeer.DataBackendDatabaseReplicationPeerStatisticsEntity -->
        <createTable tableName="data_backend_database_replication_peer_statistics" schemaName="${schema_name}">
            <column name="id" type="INTEGER" autoIncrement="true">
                <constraints nullable="false" primaryKey="true" unique="true"/>
            </column>
            <column name="id_replication_peer" type="INTEGER">
                <constraints
                    nullable="false" unique="false"
                    foreignKeyName="fk_data_backend_db_repl_peer_statistics__data_backend_db_repl_peer_id"
                    referencedTableSchemaName="${schema_name}"
                    referencedTableName="data_backend_database_replication_peer"
                    referencedColumnNames="id"
                />
            </column>
            <column name="id_backend_state_execution" type="INTEGER">
                <constraints
                    nullable="false" unique="false"
                    foreignKeyName="fk_data_backend_db_repl_peer_statistics__data_backend_state_execution_id"
                    referencedTableSchemaName="${schema_name}"
                    referencedTableName="data_backend_state_execution"
                    referencedColumnNames="id"
                />
            </column>
            <column name="is_primary" type="BOOLEAN">
                <constraints nullable="false" unique="false"/>
            </column>
            <column name="is_active" type="BOOLEAN">
                <constraints nullable="false" unique="false"/>
            </column>
            <column name="status" type="VARCHAR(255)">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="replication_pid" type="INTEGER">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="state" type="VARCHAR(50)">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="sync_state" type="VARCHAR(255)">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="replication_delay_milliseconds" type="INTEGER">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="sending_delay_size" type="INTEGER">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="receiving_delay_size" type="INTEGER">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="relaying_delay_size" type="INTEGER">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="total_delay_size" type="INTEGER">
                <constraints nullable="true" unique="false"/>
            </column>
        </createTable>
        <addUniqueConstraint
            constraintName="data_backend_database_replication_peer_statistics_uniq"
            tableName="data_backend_database_replication_peer_statistics"
            columnNames="id_replication_peer, id_backend_state_execution"
            schemaName="${schema_name}"
        />
        <createIndex tableName="data_backend_database_replication_peer_statistics"
                     indexName="data_backend_database_replication_peer_statistics_replication_pid"
                     schemaName="${schema_name}">
            <column name="replication_pid" descending="true"/>
        </createIndex>

        <!-- fr.dademo.supervision.entities.database.databaseschema.DataBackendDatabaseSchemaEntity -->
        <createTable tableName="data_backend_database_schema" schemaName="${schema_name}">
            <column name="id" type="INTEGER" autoIncrement="true">
                <constraints nullable="false" primaryKey="true" unique="true"/>
            </column>
            <column name="id_database" type="INTEGER">
                <constraints
                    nullable="false" unique="false"
                    foreignKeyName="fk_data_backend_database_schema__data_backend_database_id"
                    referencedTableSchemaName="${schema_name}"
                    referencedTableName="data_backend_database"
                    referencedColumnNames="id"
                />
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="true" unique="false"/>
            </column>
        </createTable>
        <addUniqueConstraint
            constraintName="data_backend_database_schema_uniq"
            tableName="data_backend_database_schema"
            columnNames="id_database, name"
            schemaName="${schema_name}"
        />

        <!-- fr.dademo.supervision.entities.database.databasetable.DataBackendDatabaseSchemaTableEntityEntity -->
        <createTable tableName="data_backend_database_schema_table" schemaName="${schema_name}">
            <column name="id" type="INTEGER" autoIncrement="true">
                <constraints nullable="false" primaryKey="true" unique="true"/>
            </column>
            <column name="id_schema" type="INTEGER">
                <constraints
                    nullable="false" unique="false"
                    foreignKeyName="fk_data_backend_database_schema_table__data_backend_database_schema_id"
                    referencedTableSchemaName="${schema_name}"
                    referencedTableName="data_backend_database_schema"
                    referencedColumnNames="id"
                />
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="true" unique="false"/>
            </column>
        </createTable>
        <addUniqueConstraint
            constraintName="data_backend_database_schema_table_uniq"
            tableName="data_backend_database_schema_table"
            columnNames="id_schema, name"
            schemaName="${schema_name}"
        />
        <createIndex tableName="data_backend_database_schema_table"
                     indexName="idx_data_backend_database_schema_table_name"
                     schemaName="${schema_name}">
            <column name="name" descending="true"/>
        </createIndex>

        <!-- fr.dademo.supervision.entities.database.databasetable.DataBackendDatabaseSchemaTableStatisticsEntityEntity -->
        <createTable tableName="data_backend_database_schema_table_statistics" schemaName="${schema_name}">
            <column name="id" type="INTEGER" autoIncrement="true">
                <constraints nullable="false" primaryKey="true" unique="true"/>
            </column>
            <column name="id_table" type="INTEGER">
                <constraints
                    nullable="false" unique="false"
                    foreignKeyName="fk_data_backend_database_schema_table_statistics__data_backend_database_schema_table_id"
                    referencedTableSchemaName="${schema_name}"
                    referencedTableName="data_backend_database_schema_table"
                    referencedColumnNames="id"
                />
            </column>
            <column name="id_backend_state_execution" type="INTEGER">
                <constraints
                    nullable="false" unique="false"
                    foreignKeyName="fk_data_backend_database_statistics__data_backend_state_execution_id"
                    referencedTableSchemaName="${schema_name}"
                    referencedTableName="data_backend_state_execution"
                    referencedColumnNames="id"
                />
            </column>
            <column name="rows_count" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="total_size" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="sequential_scans_count" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="sequential_scans_fetched_rows_count" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="index_scans_count" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="index_scans_fetched_rows_count" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="inserted_rows_count" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="updated_rows_count" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="deleted_rows_count" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="hot_updated_rows_count" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="live_rows_count" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="dead_rows_count" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="last_vacuum" type="DATETIME">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="last_auto_vacuum" type="DATETIME">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="last_analyze" type="DATETIME">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="last_auto_analyze" type="DATETIME">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="vacuum_count" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="auto_vacuum_count" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="analyze_count" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="auto_analyze_count" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="table_blocks_disk_read" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="table_blocks_cache_read" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="indexes_disk_read" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="indexes_cache_read" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="table_toast_disk_read" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="table_toast_cache_read" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="indexes_toast_disk_read" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="indexes_toast_cache_read" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
        </createTable>
        <addUniqueConstraint
            constraintName="data_backend_database_schema_table_statistics_uniq"
            tableName="data_backend_database_schema_table_statistics"
            columnNames="id_table, id_backend_state_execution"
            schemaName="${schema_name}"
        />

        <!-- fr.dademo.supervision.entities.database.databaseschema.DataBackendDatabaseSchemaViewEntity -->
        <createTable tableName="data_backend_database_schema_view" schemaName="${schema_name}">
            <column name="id" type="INTEGER" autoIncrement="true">
                <constraints nullable="false" primaryKey="true" unique="true"/>
            </column>
            <column name="id_schema" type="INTEGER">
                <constraints
                    nullable="false" unique="false"
                    foreignKeyName="fk_data_backend_database_view__data_backend_database_schema_id"
                    referencedTableSchemaName="${schema_name}"
                    referencedTableName="data_backend_database_schema"
                    referencedColumnNames="id"
                />
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="expression" type="CLOB">
                <constraints nullable="true" unique="false"/>
            </column>
        </createTable>
        <addUniqueConstraint
            constraintName="data_backend_database_schema_view_uniq"
            tableName="data_backend_database_schema_view"
            columnNames="id_schema, name, expression"
            schemaName="${schema_name}"
        />
        <createIndex tableName="data_backend_database_schema_view"
                     indexName="idx_data_backend_database_schema_view_name"
                     schemaName="${schema_name}">
            <column name="name" descending="true"/>
        </createIndex>
        <createIndex tableName="data_backend_database_schema_view"
                     indexName="idx_data_backend_database_schema_view_expression"
                     schemaName="${schema_name}">
            <column name="expression" descending="true"/>
        </createIndex>

        <!-- fr.dademo.supervision.entities.database.databaseschema.DataBackendDatabaseSchemaViewStatisticsEntity -->
        <createTable tableName="data_backend_database_schema_view_statistics" schemaName="${schema_name}">
            <column name="id" type="INTEGER" autoIncrement="true">
                <constraints nullable="false" primaryKey="true" unique="true"/>
            </column>
            <column name="id_view" type="INTEGER">
                <constraints
                    nullable="false" unique="false"
                    foreignKeyName="fk_data_backend_database_view__data_backend_database_schema_view_id"
                    referencedTableSchemaName="${schema_name}"
                    referencedTableName="data_backend_database_schema_view"
                    referencedColumnNames="id"
                />
            </column>
            <column name="id_backend_state_execution" type="INTEGER">
                <constraints
                    nullable="false" unique="false"
                    foreignKeyName="fk_data_backend_database_statistics__data_backend_state_execution_id"
                    referencedTableSchemaName="${schema_name}"
                    referencedTableName="data_backend_state_execution"
                    referencedColumnNames="id"
                />
            </column>
            <column name="rows_count" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="total_size" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
        </createTable>
        <addUniqueConstraint
            constraintName="data_backend_database_schema_view_statistics_uniq"
            tableName="data_backend_database_schema_view_statistics"
            columnNames="id_view, id_backend_state_execution"
            schemaName="${schema_name}"
        />

        <!-- fr.dademo.supervision.entities.database.databaseindex.DataBackendDatabaseIndexEntity -->
        <createTable tableName="data_backend_database_schema_index" schemaName="${schema_name}">
            <column name="id" type="INTEGER" autoIncrement="true">
                <constraints nullable="false" primaryKey="true" unique="true"/>
            </column>
            <column name="id_schema" type="INTEGER">
                <constraints
                    nullable="false" unique="false"
                    foreignKeyName="fk_data_backend_database_index__data_backend_database_schema_id"
                    referencedTableSchemaName="${schema_name}"
                    referencedTableName="data_backend_database_schema"
                    referencedColumnNames="id"
                />
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="table_name" type="VARCHAR(255)">
                <constraints nullable="true" unique="false"/>
            </column>
        </createTable>
        <addUniqueConstraint
            constraintName="data_backend_database_schema_index_uniq"
            tableName="data_backend_database_schema_index"
            columnNames="id_schema, name, table_name"
            schemaName="${schema_name}"
        />
        <createIndex tableName="data_backend_database_schema_index"
                     indexName="idx_data_backend_database_schema_index_name"
                     schemaName="${schema_name}">
            <column name="name" descending="true"/>
        </createIndex>

        <!-- fr.dademo.supervision.entities.database.databaseindex.DataBackendDatabaseIndexStatisticsEntity -->
        <createTable tableName="data_backend_database_schema_index_statistics" schemaName="${schema_name}">
            <column name="id" type="INTEGER" autoIncrement="true">
                <constraints nullable="false" primaryKey="true" unique="true"/>
            </column>
            <column name="id_index" type="INTEGER">
                <constraints
                    nullable="false" unique="false"
                    foreignKeyName="fk_data_backend_database_schema_index_statistics__data_backend_database_schema_index_id"
                    referencedTableSchemaName="${schema_name}"
                    referencedTableName="data_backend_database_schema_index"
                    referencedColumnNames="id"
                />
            </column>
            <column name="id_backend_state_execution" type="INTEGER">
                <constraints
                    nullable="false" unique="false"
                    foreignKeyName="fk_data_backend_database_statistics__data_backend_state_execution_id"
                    referencedTableSchemaName="${schema_name}"
                    referencedTableName="data_backend_state_execution"
                    referencedColumnNames="id"
                />
            </column>
            <column name="index_scans_count" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="returned_rows_count" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="fetched_rows_count" type="BIGINT">
                <constraints nullable="true" unique="false"/>
            </column>
        </createTable>
        <addUniqueConstraint
            constraintName="data_backend_database_schema_index_statistics_uniq"
            tableName="data_backend_database_schema_index_statistics"
            columnNames="id_index, id_backend_state_execution"
            schemaName="${schema_name}"
        />

    </changeSet>
</databaseChangeLog>